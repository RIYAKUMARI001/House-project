<% layout("/layouts/boilerplate") %>

<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-md-12">
            <h1 class="mb-4">
                <i class="fas fa-tachometer-alt"></i> Admin Dashboard
            </h1>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4><%= typeof totalListings !== 'undefined' ? totalListings : 0 %></h4>
                            <p class="mb-0">Total Listings</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-home fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4><%= typeof totalUsers !== 'undefined' ? totalUsers : 0 %></h4>
                            <p class="mb-0">Total Users</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-users fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4><%= typeof totalReviews !== 'undefined' ? totalReviews : 0 %></h4>
                            <p class="mb-0">Total Reviews</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-star fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4><%= typeof totalBookings !== 'undefined' ? totalBookings : 0 %></h4>
                            <p class="mb-0">Total Bookings</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-calendar-check fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-2">
                            <a href="/admin/listings" class="btn btn-outline-primary btn-block">
                                <i class="fas fa-list"></i> Manage Listings
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a href="/admin/listings/new" class="btn btn-outline-success btn-block">
                                <i class="fas fa-plus"></i> Add New Listing
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a href="/admin/users" class="btn btn-outline-info btn-block">
                                <i class="fas fa-users"></i> Manage Users
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a href="/listings" class="btn btn-outline-secondary btn-block">
                                <i class="fas fa-eye"></i> View Site
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Recent Listings</h5>
                </div>
                <div class="card-body">
                    <% if (typeof recentListings !== 'undefined' && recentListings.length > 0) { %>
                        <% recentListings.forEach(listing => { %>
                            <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                                <div>
                                    <h6 class="mb-1"><%= listing.title %></h6>
                                    <small class="text-muted">by <%= listing.owner ? listing.owner.username : 'Unknown' %></small>
                                </div>
                                <div class="text-right">
                                    <span class="badge badge-<%= listing.isAvailable ? 'success' : 'danger' %>">
                                        <%= listing.isAvailable ? 'Available' : 'Unavailable' %>
                                    </span>
                                    <br>
                                    <small class="text-muted">â‚¹<%= listing.price %>/night</small>
                                </div>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p class="text-muted">No listings found.</p>
                    <% } %>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Recent Users</h5>
                </div>
                <div class="card-body">
                    <% if (typeof recentUsers !== 'undefined' && recentUsers.length > 0) { %>
                        <% recentUsers.forEach(user => { %>
                            <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                                <div>
                                    <h6 class="mb-1"><%= user.username %></h6>
                                    <small class="text-muted"><%= user.email %></small>
                                </div>
                                <div class="text-right">
                                    <span class="badge badge-<%= user.isAdmin ? 'primary' : 'secondary' %>">
                                        <%= user.isAdmin ? 'Admin' : 'User' %>
                                    </span>
                                    <br>
                                    <small class="text-muted">
                                        <%= user.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'N/A' %>
                                    </small>
                                </div>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p class="text-muted">No users found.</p>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
</div>